angular.module("bgradarApp.controllers",[]).controller("WallController",["$scope","$modal","BGlbs",function($scope,$modal,BGlbs){var init=function(){$scope.selectedRecord={};BGlbs.list(function(data){$scope.records=data.results})};init(),$scope.showModal=function(selectedRecord){$("#myModal").modal(),$scope.website=selectedRecord.fans_url,$scope.comment=selectedRecord.comment,$scope.selectedRecord=selectedRecord},$scope.save=function(){var patchData={_id:$scope.selectedRecord.uid,comment:$scope.comment||"",fans_url:$scope.website||""};BGlbs.updateData(patchData,function(){alert("感謝眾鄉民的工人智慧！"),$("#myModal").modal("toggle"),$scope.website="",$scope.comment="",init()})}}]).controller("RadarController",["$scope","BGlbs","$timeout",function($scope,BGlbs){google.maps.visualRefresh=!0;var init=function(){$scope.selectedRecord={},BGlbs.list(function(data){var markers=[];_.each(data.results,function(marker){var obj={id:marker.uid,latitude:marker.lat,longitude:marker.lng,title:"Test Record",showWindow:!1,comment:marker.comment,fans_url:marker.fans_url,picurl:marker.picurl};obj.closeClick=function(){marker.showWindow=!1,$scope.$apply()},obj.onClicked=function(){$scope.onMarkerClicked(obj)},markers.push(obj)}),$scope.map.dynamicMarkers=markers}),$scope.map={center:{latitude:25.041762,longitude:121.549071},zoom:15}};$scope.refreshMap=function(){$scope.map.control.refresh({latitude:25.041762,longitude:121.549071})},$scope.onMarkerClicked=function(marker){$scope.selectedRecord=marker,$("#myModal").modal(),$scope.website=marker.fans_url,$scope.comment=marker.comment,$scope.$apply()},$scope.save=function(){var patchData={_id:$scope.selectedRecord.id,comment:$scope.comment||"",fans_url:$scope.website||""};BGlbs.updateData(patchData,function(){alert("感謝眾鄉民的工人智慧！"),$("#myModal").modal("toggle"),$scope.website="",$scope.comment="",init()})},init()}]);